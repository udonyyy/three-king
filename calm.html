<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>放轻松！ - Three KING</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='45' fill='%238fbcbb'/></svg>">
  <style>
    /* 基础样式与响应式变量 */
    :root {
      --bg: #f7f9f9;
      --accent-1: #8fbcbb;
      --accent-2: #b19cd9;
      --accent-3: #98c1d9;
      --text: #5a6268;
      --card-bg: #ffffff;
      --shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    html, body {
      height: 100vh;
      width: 100vw;
      background-color: var(--bg);
      font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", sans-serif;
      color: var(--text);
      overflow: hidden;
    }
    
    body {
      display: flex;
      flex-direction: column;
    }
    
    /* 头部样式 */
    header {
      padding: 16px 12px;
      text-align: center;
      background: rgba(255,255,255,0.9);
      backdrop-filter: blur(10px);
      position: relative;
      z-index: 10;
    }
    
    .three-king-link {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--accent-2);
      text-decoration: none;
      font-size: clamp(0.8rem, 3vw, 1rem);
      font-weight: 500;
      transition: all 0.2s ease;
    }
    
    .three-king-link:hover {
      color: var(--accent-1);
      text-decoration: underline;
    }
    
    .app-title {
      font-size: clamp(1.2rem, 5vw, 1.5rem);
      color: #444;
      margin-bottom: 8px;
    }
    
    .app-desc {
      font-size: clamp(0.8rem, 3vw, 0.9rem);
      color: var(--text);
    }
    
    /* 标签栏样式 */
    .tabs {
      display: flex;
      overflow-x: auto;
      padding: 0 12px 12px;
      gap: 8px;
      scrollbar-width: none;
      background: rgba(255,255,255,0.9);
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 10px rgba(0,0,0,0.03);
      z-index: 10;
      position: relative;
    }
    
    .tabs::-webkit-scrollbar {
      display: none;
    }
    
    .tab-btn {
      flex: 0 0 auto;
      padding: 6px 14px;
      border: none;
      border-radius: 20px;
      background: #e9ecef;
      color: var(--text);
      font-size: clamp(0.8rem, 3vw, 0.9rem);
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.2s ease;
    }
    
    .tab-btn.active {
      background: var(--accent-1);
      color: white;
    }
    
    /* 主内容区 */
    .main-container {
      flex: 1;
      width: 100%;
      padding: 0;
      display: flex;
      flex-direction: column;
    }
    
    /* 游戏容器通用样式 */
    .game-container {
      flex: 1;
      width: 100%;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 16px;
      position: relative;
    }
    
    .game-container.active {
      display: flex;
    }
    
    .game-card {
      width: 100%;
      height: 100%;
      max-width: none;
      background: var(--card-bg);
      border-radius: 0;
      box-shadow: none;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
    }
    
    .game-content {
      flex: 1;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }
    
    .game-instructions {
      font-size: clamp(0.8rem, 3vw, 0.9rem);
      text-align: center;
      margin-top: 16px;
      padding: 0 8px;
      line-height: 1.5;
      max-width: 600px;
      background: rgba(255,255,255,0.8);
      padding: 8px 16px;
      border-radius: 12px;
      backdrop-filter: blur(5px);
      z-index: 10;
      position: relative;
    }
    
    .encourage-text {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255,255,255,0.9);
      padding: 6px 12px;
      border-radius: 16px;
      font-size: clamp(0.75rem, 3vw, 0.85rem);
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
      max-width: 80%;
      text-align: center;
      z-index: 10;
    }
    
    .encourage-text.show {
      opacity: 1;
      pointer-events: auto;
    }
    
    .interaction-btns {
      display: flex;
      gap: 8px;
      margin-top: 12px;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 10px;
      z-index: 10;
      position: relative;
    }
    
    .interact-btn {
      padding: 8px 16px;
      border: 1px solid var(--accent-1);
      border-radius: 16px;
      background: transparent;
      color: var(--accent-1);
      font-size: clamp(0.75rem, 3vw, 0.85rem);
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .interact-btn:hover {
      background: var(--accent-1);
      color: white;
    }
    
    .control-btn {
      position: absolute;
      bottom: 20px;
      right: 20px;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: none;
      background: white;
      color: var(--text);
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 1rem;
      z-index: 10;
    }
    
    /* 1. 呼吸泡泡 */
    #bubble {
      width: clamp(120px, 50vw, 220px);
      height: clamp(120px, 50vw, 220px);
      border-radius: 50%;
      background: var(--accent-1);
      opacity: 0.7;
      transition: transform 4s cubic-bezier(0.4, 0, 0.6, 1);
    }
    
    #bubble-guide {
      position: absolute;
      color: var(--text);
      font-size: clamp(0.9rem, 3vw, 1.1rem);
    }
    
    /* 3. 折纸雨（全屏交互） */
    #paper-container {
      width: 100%;
      height: 100%;
      position: relative;
      background: #f5f5f5;
      overflow: hidden;
    }
    
    .fold {
      position: absolute;
      font-size: clamp(0.9rem, 3vw, 1.5rem); /* 更小的纸张尺寸 */
      pointer-events: none;
      transition: transform 0.4s ease, opacity 0.4s ease;
    }
    
    /* 4. 雨滴涟漪 */
    #rain-container {
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      background: #f0f4f8;
      overflow: hidden;
      cursor: pointer;
    }
    
    .ripple {
      position: absolute;
      border-radius: 50%;
      opacity: 0.6;
      pointer-events: none;
      filter: blur(0.5px);
    }
    
    /* 5. 静止的表情 */
    #emoji-game {
      width: 100%;
      height: 100%;
      border-radius: 8px;
      background: #fff8f0;
      border: 1px solid #ffe8d6;
      overflow: hidden;
      cursor: pointer;
      position: relative;
    }
    
    .emoji-item {
      position: absolute;
      font-size: clamp(1rem, 4vw, 1.8rem);
    }
    
    #emoji-status {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: clamp(0.8rem, 3vw, 0.9rem);
      color: var(--text);
      background: rgba(255,255,255,0.8);
      padding: 6px 12px;
      border-radius: 15px;
      backdrop-filter: blur(5px);
      z-index: 5;
    }
    
    .difficulty-btns {
      display: flex;
      gap: 8px;
      margin-top: 10px;
      z-index: 10;
      position: relative;
    }
    
    .difficulty-btn {
      padding: 4px 10px;
      border-radius: 12px;
      border: 1px solid var(--accent-1);
      background: transparent;
      color: var(--accent-1);
      font-size: 0.8rem;
      cursor: pointer;
    }
    
    .difficulty-btn.active {
      background: var(--accent-1);
      color: white;
    }
  </style>
</head>
<body>
  <header>
    <a href="index.html" class="three-king-link">Three King</a>
    <div class="app-title">Take it easy！</div>
    <div class="app-desc">静不下来？玩30秒，让大脑慢下来</div>
  </header>
  
  <div class="tabs">
    <button class="tab-btn active" data-game="breathe">呼吸泡泡</button>
    <button class="tab-btn" data-game="paper">折纸雨</button>
    <button class="tab-btn" data-game="rain">雨滴涟漪</button>
    <button class="tab-btn" data-game="emoji">静止表情</button>
  </div>
  
  <div class="main-container">
    <!-- 1. 呼吸泡泡 -->
    <div class="game-container active" id="breathe">
      <div class="game-card">
        <div class="encourage-text" id="breathe-encourage">跟着节奏呼吸，感受平静</div>
        <div class="game-content">
          <div id="bubble"></div>
          <div id="bubble-guide">吸气...</div>
        </div>
        <div class="game-instructions">
          泡泡膨胀时吸气，收缩时呼气，重复几次，让呼吸平稳下来
        </div>
        <div class="interaction-btns">
          <button class="interact-btn" data-resp="breathe-1">感觉平静多了</button>
          <button class="interact-btn" data-resp="breathe-2">再试一次</button>
        </div>
        <button class="control-btn" id="bubble-reset" title="重置">↺</button>
      </div>
    </div>
    
    <!-- 3. 折纸雨（全屏交互） -->
    <div class="game-container" id="paper">
      <div class="game-card">
        <div class="encourage-text" id="paper-encourage">每张纸都有自己的轨迹</div>
        <div class="game-content">
          <!-- 移除容器限制，直接全屏 -->
          <div id="paper-container"></div>
        </div>
        <div class="game-instructions">
          看纸张缓缓飘落，点击屏幕任意位置增加更多纸张，感受这份宁静
        </div>
        <div class="interaction-btns">
          <button class="interact-btn" data-resp="paper-1">很放松</button>
          <button class="interact-btn" data-resp="paper-2">换种样式</button>
        </div>
        <button class="control-btn" id="paper-clear" title="清除">✕</button>
      </div>
    </div>
    
    <!-- 4. 雨滴涟漪 -->
    <div class="game-container" id="rain">
      <div class="game-card">
        <div class="encourage-text" id="rain-encourage">涟漪扩散，带走烦躁</div>
        <div class="game-content">
          <div id="rain-container"></div>
        </div>
        <div class="game-instructions">
          点击屏幕任意位置创造涟漪，感受水波扩散的宁静，仿佛雨滴落在湖面
        </div>
        <div class="interaction-btns">
          <button class="interact-btn" data-resp="rain-1">像真的雨声</button>
          <button class="interact-btn" data-resp="rain-2">多来点涟漪</button>
        </div>
        <button class="control-btn" id="rain-reset" title="重置">↺</button>
      </div>
    </div>
    
    <!-- 5. 静止的表情 -->
    <div class="game-container" id="emoji">
      <div class="game-card">
        <div class="encourage-text" id="emoji-encourage">找到那个不动的表情（速度更快！）</div>
        <div class="game-content">
          <div id="emoji-game">
            <div id="emoji-status">寻找静止的表情...</div>
          </div>
        </div>
        <div class="game-instructions">
          在快速移动的众多表情中，找出那个完全静止的，点击它。挑战你的极限专注力！
        </div>
        <div class="difficulty-btns">
          <button class="difficulty-btn" data-difficulty="easy">简单</button>
          <button class="difficulty-btn" data-difficulty="medium">中等</button>
          <button class="difficulty-btn active" data-difficulty="hard">困难</button>
        </div>
        <div class="interaction-btns">
          <button class="interact-btn" data-resp="emoji-1">找到了！</button>
          <button class="interact-btn" data-resp="emoji-2">再玩一次</button>
        </div>
        <button class="control-btn" id="emoji-reset" title="重置">↺</button>
      </div>
    </div>
  </div>

  <script>
    // 响应式布局
    function adjustGameSize() {
      const gameContents = document.querySelectorAll('.game-content');
      gameContents.forEach(content => {
        content.style.height = `${content.parentElement.offsetHeight - 100}px`;
      });
    }
    
    window.addEventListener('load', adjustGameSize);
    window.addEventListener('resize', adjustGameSize);
    
    // 标签切换
    const tabBtns = document.querySelectorAll('.tab-btn');
    const gameContainers = document.querySelectorAll('.game-container');
    
    tabBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const targetGame = btn.getAttribute('data-game');
        tabBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        gameContainers.forEach(container => container.classList.remove('active'));
        document.getElementById(targetGame).classList.add('active');
        showEncouragement(targetGame);
        adjustGameSize();
      });
    });
    
    // 鼓励文字系统
    const encourageTexts = {
      breathe: [
        "呼吸是最好的放松方式",
        "吸气4秒，呼气4秒，你做得很好",
        "感受腹部随呼吸起伏",
        "每一次呼吸都让你更平静"
      ],
      paper: [
        "每张纸都有自己的旅程，不必急着到达终点",
        "让视线跟随一张纸，暂时放下其他思绪",
        "飘落的纸张像纷乱的想法，最终都会平息",
        "每一张纸都是独特的，就像每一刻的感受"
      ],
      rain: [
        "涟漪扩散的样子，就像平静在蔓延",
        "雨滴落下的声音，能洗去大脑的疲惫",
        "每一圈涟漪都在说：一切都会平息",
        "想象烦恼像涟漪一样，慢慢消散"
      ],
      emoji: [
        "速度很快！集中所有注意力",
        "眼睛和大脑正在高速运转，坚持住",
        "静止的那个就在其中，仔细找",
        "挑战极限专注力，你可以的！"
      ]
    };
    
    const responseTexts = {
      "breathe-1": "太好了！这种平静能帮你更好地专注",
      "breathe-2": "没问题，再来一轮深呼吸",
      "paper-1": "太棒了！放松是为了更好地前进",
      "paper-2": "新的纸张来了，继续享受宁静吧",
      "rain-1": "雨声总能让人平静，像大自然在安抚我们",
      "rain-2": "看，更多涟漪在扩散，带走烦躁",
      "emoji-1": "太厉害了！你拥有超强专注力！",
      "emoji-2": "再来挑战一次！"
    };
    
    function showEncouragement(game) {
      document.querySelectorAll('.encourage-text').forEach(el => el.classList.remove('show'));
      const elem = document.getElementById(`${game}-encourage`);
      if (elem) {
        const texts = encourageTexts[game];
        elem.textContent = texts[Math.floor(Math.random() * texts.length)];
        elem.classList.add('show');
      }
    }
    
    // 互动按钮事件
    const interactBtns = document.querySelectorAll('.interact-btn');
    interactBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const respKey = btn.getAttribute('data-resp');
        const game = respKey.split('-')[0];
        const elem = document.getElementById(`${game}-encourage`);
        elem.textContent = responseTexts[respKey];
        elem.classList.add('show');
        
        if (respKey === 'paper-2') changePaperType();
        if (respKey === 'rain-2') addMoreRipples();
        if (respKey === 'emoji-2') startEmojiGame(currentDifficulty);
        
        setTimeout(() => showEncouragement(game), 3000);
      });
    });
    
    // 1. 呼吸泡泡
    let isGrowing = true;
    const bubble = document.getElementById('bubble');
    const bubbleGuide = document.getElementById('bubble-guide');
    
    function breatheAnimation() {
      if (isGrowing) {
        bubble.style.transform = 'scale(1.4)';
        bubbleGuide.textContent = '吸气...';
      } else {
        bubble.style.transform = 'scale(1)';
        bubbleGuide.textContent = '呼气...';
      }
      isGrowing = !isGrowing;
    }
    
    let breatheInterval = setInterval(breatheAnimation, 4000);
    
    document.getElementById('bubble-reset').addEventListener('click', () => {
      clearInterval(breatheInterval);
      bubble.style.transform = 'scale(1)';
      isGrowing = true;
      bubbleGuide.textContent = '吸气...';
      breatheInterval = setInterval(breatheAnimation, 4000);
      showEncouragement('breathe');
    });
    
    // 3. 折纸雨（全屏交互）
    const paperContainer = document.getElementById('paper-container');
    let paperTypes = ['📜', '📄', '📃', '📑'];
    const paperElements = [];
    
    const paperConfig = {
      minLifetime: 7000,
      maxLifetime: 12000,
      spawnInterval: 1000, // 降低生成频率（更少纸张）
      clickSpawnCount: 5,
      initialFallSpeedRange: [0.1, 0.5], // 慢速下落
      gravity: 0.002,
      maxFallSpeed: 1.2,
      driftFrequencyRange: [0.006, 0.015],
      driftAmplitudeRange: [0.6, 2],
      rotateSpeedRange: [-0.15, 0.15],
      rotateDamping: 0.996
    };
    
    function createPaper(isClickSpawn = false) {
      const paper = document.createElement('div');
      paper.className = 'fold';
      paper.innerHTML = paperTypes[Math.floor(Math.random() * paperTypes.length)];

      // 全屏容器尺寸
      const container = paperContainer;
      const containerRect = container.getBoundingClientRect();
      const containerWidth = containerRect.width;
      const containerHeight = containerRect.height;

      // 随机起始位置（全屏范围）
      const startLeft = isClickSpawn 
        ? (Math.random() * containerWidth) / containerWidth * 100 
        : Math.random() * 100;
      paper.style.left = startLeft + '%';
      paper.style.top = isClickSpawn ? Math.random() * 10 + '%' : '-10%';

      const initialOpacity = 0.8 + Math.random() * 0.2;
      const initialSize = 1.2 + Math.random() * 0.3; // 更小的初始尺寸
      paper.style.opacity = 0;
      paper.style.transform = `scale(0.5) rotate(0deg)`;

      // 柔和的纸张颜色
      const colors = ['#90cdf4', '#9ae6b4', '#b794f4', '#f6ad55', '#fda4af'];
      paper.style.color = colors[Math.floor(Math.random() * colors.length)];

      container.appendChild(paper);
      paperElements.push(paper);

      setTimeout(() => {
        paper.style.opacity = initialOpacity;
        paper.style.transform = `scale(${initialSize}) rotate(0deg)`;
      }, 10);

      const physics = {
        fallSpeed: paperConfig.initialFallSpeedRange[0] + Math.random() * (paperConfig.initialFallSpeedRange[1] - paperConfig.initialFallSpeedRange[0]),
        left: startLeft,
        rotateAngle: 0,
        rotateSpeed: (Math.random() - 0.5) * 0.15,
        driftPhase: Math.random() * Math.PI * 2,
        driftFrequency: paperConfig.driftFrequencyRange[0] + Math.random() * (paperConfig.driftFrequencyRange[1] - paperConfig.driftFrequencyRange[0]),
        lifetime: 0,
        maxLifetime: paperConfig.minLifetime + Math.random() * (paperConfig.maxLifetime - paperConfig.minLifetime)
      };

      function fall() {
        if (!paper.parentNode) return;
        physics.lifetime += 16;

        physics.fallSpeed = Math.min(physics.fallSpeed + paperConfig.gravity, paperConfig.maxFallSpeed);
        const currentTop = parseFloat(paper.style.top) || (isClickSpawn ? 0 : -50);
        const newTop = currentTop + physics.fallSpeed;
        paper.style.top = newTop + 'px';

        const windEffect = Math.sin(physics.lifetime * physics.driftFrequency + physics.driftPhase) * paperConfig.driftAmplitudeRange[0];
        physics.left += windEffect * 0.04;
        physics.left = Math.max(5, Math.min(95, physics.left));
        paper.style.left = physics.left + '%';

        physics.rotateSpeed *= paperConfig.rotateDamping;
        physics.rotateAngle += physics.rotateSpeed;
        const maxRotate = isClickSpawn ? 45 : 30;
        physics.rotateAngle = Math.max(-maxRotate, Math.min(maxRotate, physics.rotateAngle));
        paper.style.transform = `scale(${initialSize}) rotate(${physics.rotateAngle}deg)`;

        const isOutOfBounds = newTop > containerHeight + 30;
        const isLifetimeEnded = physics.lifetime > physics.maxLifetime;

        if (isOutOfBounds && isLifetimeEnded) {
          paper.style.transition = 'opacity 1.5s ease, transform 1.5s ease';
          paper.style.opacity = 0;
          paper.style.transform = `scale(${initialSize * 0.7}) rotate(${physics.rotateAngle}deg)`;

          setTimeout(() => {
            paper.remove();
            const index = paperElements.indexOf(paper);
            if (index > -1) paperElements.splice(index, 1);
          }, 1500);
        } else {
          requestAnimationFrame(fall);
        }
      }

      fall();
    }
    
    // 自动生成纸张（仅在折纸雨激活时）
    setInterval(() => {
      if (document.getElementById('paper').classList.contains('active')) {
        createPaper(false);
      }
    }, paperConfig.spawnInterval);
    
    // 全屏点击生成纸张
    paperContainer.addEventListener('click', (e) => {
      const rect = paperContainer.getBoundingClientRect();
      const clickXPercent = ((e.clientX - rect.left) / rect.width) * 100;

      const clickSound = new Audio('data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAzMzMzMzMzM5WZmZmZmZmnd7e3t7e3uHl5eXl5eXno6Ojo6Ojo6iwsLCwsLCvi4uLi4uLi52tra2tra2u7u7u7u7u7+/v7+/v7+/');
      clickSound.volume = 0.2;
      clickSound.play().catch(e => {});

      for (let i = 0; i < paperConfig.clickSpawnCount; i++) {
        setTimeout(() => {
          const paper = document.createElement('div');
          paper.className = 'fold';
          paper.innerHTML = paperTypes[Math.floor(Math.random() * paperTypes.length)];

          const left = clickXPercent + (Math.random() * 10 - 5);
          const top = Math.random() * 8;
          paper.style.left = left + '%';
          paper.style.top = top + '%';

          const opacity = 0.85 + Math.random() * 0.15;
          const size = 1.3 + Math.random() * 0.3;
          paper.style.opacity = 0;
          paper.style.transform = `scale(0.5) rotate(0deg)`;

          const colors = ['#90cdf4', '#9ae6b4', '#b794f4', '#f6ad55', '#fda4af'];
          paper.style.color = colors[Math.floor(Math.random() * colors.length)];

          paperContainer.appendChild(paper);
          paperElements.push(paper);

          setTimeout(() => {
            paper.style.opacity = opacity;
            paper.style.transform = `scale(${size}) rotate(0deg)`;
          }, 10);

          const clickPhysics = {
            fallSpeed: paperConfig.initialFallSpeedRange[0] + Math.random() * 0.6,
            left: left,
            rotateAngle: 0,
            rotateSpeed: (Math.random() - 0.5) * 0.25,
            driftPhase: Math.random() * Math.PI * 2,
            driftFrequency: paperConfig.driftFrequencyRange[0] + Math.random() * 0.005,
            lifetime: 0,
            maxLifetime: paperConfig.minLifetime + 1000 + Math.random() * (paperConfig.maxLifetime - paperConfig.minLifetime)
          };

          function clickFall() {
            if (!paper.parentNode) return;
            clickPhysics.lifetime += 16;

            clickPhysics.fallSpeed = Math.min(
              clickPhysics.fallSpeed + paperConfig.gravity * 1.2,
              paperConfig.maxFallSpeed * 1.1
            );
            const currentTop = parseFloat(paper.style.top);
            const newTop = currentTop + clickPhysics.fallSpeed;
            paper.style.top = newTop + 'px';

            const windEffect = Math.sin(clickPhysics.lifetime * clickPhysics.driftFrequency + clickPhysics.driftPhase) * paperConfig.driftAmplitudeRange[0] * 0.8;
            clickPhysics.left += windEffect * 0.05;
            clickPhysics.left = Math.max(5, Math.min(95, clickPhysics.left));
            paper.style.left = clickPhysics.left + '%';

            clickPhysics.rotateSpeed *= paperConfig.rotateDamping;
            clickPhysics.rotateAngle += clickPhysics.rotateSpeed;
            clickPhysics.rotateAngle = Math.max(-45, Math.min(45, clickPhysics.rotateAngle));
            paper.style.transform = `scale(${size}) rotate(${clickPhysics.rotateAngle}deg)`;

            const isOutOfBounds = newTop > paperContainer.offsetHeight + 20;
            const isLifetimeEnded = clickPhysics.lifetime > clickPhysics.maxLifetime;

            if (isOutOfBounds && isLifetimeEnded) {
              paper.style.transition = 'opacity 1.5s ease, transform 1.5s ease';
              paper.style.opacity = 0;
              paper.style.transform = `scale(${size * 0.6}) rotate(${clickPhysics.rotateAngle}deg)`;

              setTimeout(() => {
                paper.remove();
                const idx = paperElements.indexOf(paper);
                if (idx > -1) paperElements.splice(idx, 1);
              }, 1500);
            } else {
              requestAnimationFrame(clickFall);
            }
          }

          clickFall();
        }, i * 100);
      }
    });
    
    // 清除纸张
    document.getElementById('paper-clear').addEventListener('click', () => {
      paperElements.forEach(paper => {
        paper.style.transition = 'opacity 0.8s ease, transform 0.8s ease';
        paper.style.opacity = 0;
        paper.style.transform = 'scale(0.3)';
        setTimeout(() => paper.remove(), 800);
      });
      paperElements.length = 0;
    });
    
    // 切换纸张类型
    function changePaperType() {
      const typeGroups = [
        ['📜', '📄', '📃', '📑'],
        ['🍃', '🍂', '🌿', '🌾'],
        ['❄️', '🌨️', '☁️', '🍃']
      ];
      let newTypes;
      do {
        newTypes = typeGroups[Math.floor(Math.random() * typeGroups.length)];
      } while (newTypes === paperTypes);
      paperTypes = newTypes;
    }
    
    // 4. 雨滴涟漪（优化颜色和尺寸，增加自动生成频率和范围）
const rainContainer = document.getElementById('rain-container');

// 减少涟漪颜色（仅保留浅蓝、浅绿两种柔和色调）
const rippleColors = ['#90cdf480', '#9ae6b480']; // 移除了 '#b794f480'（浅紫色）

function createRipple(x, y, isClick = false) {
  const ripple = document.createElement('div');
  ripple.className = 'ripple';
  
  // 缩小涟漪尺寸（最大150px）
  const size = isClick 
    ? 60 + Math.random() * 90  // 点击生成：60-150px
    : 40 + Math.random() * 60; // 自动生成：40-100px
  ripple.style.width = size + 'px';
  ripple.style.height = size + 'px';
  ripple.style.left = (x - size/2) + 'px';
  ripple.style.top = (y - size/2) + 'px';
  
  // 使用统一的柔和颜色（已移除紫色）
  ripple.style.background = rippleColors[Math.floor(Math.random() * rippleColors.length)];
  
  rainContainer.appendChild(ripple);
  
  // 扩散范围和动画时长保持不变
  const scale = isClick 
    ? 3 + Math.random() * 2  // 点击生成：3-5倍
    : 3 + Math.random() * 3; // 自动生成：3-6倍
  
  const duration = isClick 
    ? 3 + Math.random()      // 点击生成：3-4秒
    : 3 + Math.random() * 2; // 自动生成：3-5秒
  
  setTimeout(() => {
    ripple.style.transition = `transform ${duration}s cubic-bezier(0.2, 0.8, 0.2, 1), opacity ${duration}s ease-out`;
    ripple.style.transform = `scale(${scale})`;
    ripple.style.opacity = '0';
    
    setTimeout(() => ripple.remove(), duration * 1000);
  }, 10);
}
    
    // 【核心修改3：提高自动生成频率（缩短间隔）】
    // 从原来的3000ms（3秒）→ 改为1000ms（1秒），生成更频繁
    setInterval(() => {
      if (document.getElementById('rain').classList.contains('active')) {
        const x = Math.random() * window.innerWidth;
        const y = Math.random() * window.innerHeight;
        createRipple(x, y); // 自动生成涟漪
      }
    }, 1000); // 1秒生成一个（频率提高）
    
    // 全屏点击生成涟漪
    rainContainer.addEventListener('click', (e) => {
      const x = e.clientX;
      const y = e.clientY;

      // 点击生成少量涟漪（3个）
      for (let i = 0; i < 3; i++) {
        setTimeout(() => {
          createRipple(
            x + (Math.random() * 40 - 20),
            y + (Math.random() * 40 - 20),
            true
          );
        }, i * 150);
      }
    });
    
    // 多来点涟漪按钮
    function addMoreRipples() {
      for (let i = 0; i < 5; i++) {
        setTimeout(() => {
          const x = Math.random() * window.innerWidth;
          const y = Math.random() * window.innerHeight;
          createRipple(x, y, true);
        }, i * 250);
      }
    }
    
    // 重置涟漪
    document.getElementById('rain-reset').addEventListener('click', () => {
      document.querySelectorAll('.ripple').forEach(r => r.remove());
    });
    
    // 5. 静止的表情
    const emojiGame = document.getElementById('emoji-game');
    const emojiStatus = document.getElementById('emoji-status');
    const difficultyBtns = document.querySelectorAll('.difficulty-btn');
    let emojiItems = [];
    let staticEmoji = null;
    let currentDifficulty = 'hard';
    
    const difficultyConfig = {
      easy: { count: window.innerWidth < 400 ? 30 : 50, baseSpeed: 0.5, speedVariation: 1.5, range: 10, rangeVariation: 20, sameRatio: 0.5, encouragement: "简单模式：你可以的！" },
      medium: { count: window.innerWidth < 400 ? 80 : 120, baseSpeed: 1, speedVariation: 2, range: 15, rangeVariation: 25, sameRatio: 0.75, encouragement: "中等模式：难度升级了！" },
      hard: { count: window.innerWidth < 400 ? 150 : 200, baseSpeed: 1.5, speedVariation: 3, range: 20, rangeVariation: 30, sameRatio: 0.2, encouragement: "困难模式：极限挑战！" }
    };
    
    const emojis = ['😊', '😍', '😎', '🥺', '😜', '🤩', '🤔', '😌', '🙂', '😇', '🥰', '😉', '😌', '🤗', '🤭', '😋', '😘', '🤪', '🤫', '🤭'];
    
    difficultyBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        difficultyBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentDifficulty = btn.getAttribute('data-difficulty');
        const elem = document.getElementById('emoji-encourage');
        elem.textContent = difficultyConfig[currentDifficulty].encouragement;
        elem.classList.add('show');
        startEmojiGame(currentDifficulty);
      });
    });
    
    function startEmojiGame(difficulty) {
      emojiItems.forEach(emoji => emoji.remove());
      emojiItems = [];
      const config = difficultyConfig[difficulty];
      const staticType = emojis[Math.floor(Math.random() * emojis.length)];
      staticEmoji = null;
      
      for (let i = 0; i < config.count; i++) {
        const emoji = document.createElement('div');
        emoji.className = 'emoji-item';
        const isSame = Math.random() > (1 - config.sameRatio);
        emoji.textContent = isSame ? staticType : emojis[Math.floor(Math.random() * emojis.length)];
        emoji.style.left = Math.random() * 100 + '%';
        emoji.style.top = Math.random() * 100 + '%';
        const colors = ['var(--accent-1)', 'var(--accent-2)', 'var(--accent-3)'];
        emoji.style.color = colors[Math.floor(Math.random() * colors.length)];
        emojiGame.appendChild(emoji);
        emojiItems.push(emoji);
        
        if (i === 0) {
          staticEmoji = emoji;
          emoji.dataset.static = 'true';
        } else {
          animateEmoji(emoji, config);
        }
      }
      
      emojiStatus.textContent = `寻找静止的表情... ${difficulty === 'easy' ? '简单' : difficulty === 'medium' ? '中等' : '困难'}模式`;
    }
    
    function animateEmoji(emoji, config) {
      const startX = parseFloat(emoji.style.left);
      const startY = parseFloat(emoji.style.top);
      const speed = config.baseSpeed + Math.random() * config.speedVariation;
      const range = config.range + Math.random() * config.rangeVariation;
      const direction = Math.random() * Math.PI * 2;
      const moveMode = Math.floor(Math.random() * 3);
      const phaseX = Math.random() * Math.PI * 2;
      const phaseY = Math.random() * Math.PI * 2;
      let time = 0;

      function move() {
        if (!emoji.parentNode) return;
        time += 0.01;
        let x, y;
        
        switch (moveMode) {
          case 0:
            const radius = range * 0.5;
            const angle = time * speed + direction;
            x = startX + Math.cos(angle + phaseX) * radius;
            y = startY + Math.sin(angle + phaseY) * radius;
            break;
          case 1:
            const progress = Math.sin(time * speed + phaseX) * 0.5 + 0.5;
            x = startX + Math.cos(direction) * range * (progress - 0.5) * 2;
            y = startY + Math.sin(direction) * range * (progress - 0.5) * 2;
            break;
          case 2:
            x = startX + (Math.sin(time * speed + phaseX) * range * 0.5) + (Math.random() - 0.5) * 2;
            y = startY + (Math.cos(time * speed + phaseY) * range * 0.5) + (Math.random() - 0.5) * 2;
            break;
        }
        
        x = Math.max(0, Math.min(100, x));
        y = Math.max(0, Math.min(100, y));
        emoji.style.left = x + '%';
        emoji.style.top = y + '%';
        requestAnimationFrame(move);
      }
      
      move();
    }
    
    emojiGame.addEventListener('click', (e) => {
      const target = e.target.closest('.emoji-item');
      if (!target) return;
      
      if (target.dataset.static === 'true') {
        emojiStatus.textContent = "太厉害了！你拥有超强专注力！";
        target.style.transform = "scale(2)";
        target.style.transition = "transform 0.3s ease";
        setTimeout(() => startEmojiGame(currentDifficulty), 2000);
      } else {
        emojiStatus.textContent = "再试试，那个还在动呢";
        target.style.transform = "scale(0)";
        setTimeout(() => {
          if (target.parentNode) target.remove();
        }, 300);
      }
    });
    
    document.getElementById('emoji-reset').addEventListener('click', () => {
      startEmojiGame(currentDifficulty);
    });
    
    // 初始化
    window.addEventListener('load', () => {
      showEncouragement('breathe');
      startEmojiGame(currentDifficulty);
    });
  </script>
</body>
</html>