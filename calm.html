<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>æ”¾è½»æ¾ï¼ - Three KING</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='45' fill='%238fbcbb'/></svg>">
  <style>
    /* åŸºç¡€æ ·å¼ä¸å“åº”å¼å˜é‡ */
    :root {
      --bg: #f7f9f9;
      --accent-1: #8fbcbb;
      --accent-2: #b19cd9;
      --accent-3: #98c1d9;
      --text: #5a6268;
      --card-bg: #ffffff;
      --shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    html, body {
      height: 100vh;
      width: 100vw;
      background-color: var(--bg);
      font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", sans-serif;
      color: var(--text);
      overflow: hidden;
    }
    
    body {
      display: flex;
      flex-direction: column;
    }
    
    /* å¤´éƒ¨æ ·å¼ */
    header {
      padding: 16px 12px;
      text-align: center;
      background: rgba(255,255,255,0.9);
      backdrop-filter: blur(10px);
      position: relative;
      z-index: 10;
    }
    
    .three-king-link {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--accent-2);
      text-decoration: none;
      font-size: clamp(0.8rem, 3vw, 1rem);
      font-weight: 500;
      transition: all 0.2s ease;
    }
    
    .three-king-link:hover {
      color: var(--accent-1);
      text-decoration: underline;
    }
    
    .app-title {
      font-size: clamp(1.2rem, 5vw, 1.5rem);
      color: #444;
      margin-bottom: 8px;
    }
    
    .app-desc {
      font-size: clamp(0.8rem, 3vw, 0.9rem);
      color: var(--text);
    }
    
    /* æ ‡ç­¾æ æ ·å¼ */
    .tabs {
      display: flex;
      overflow-x: auto;
      padding: 0 12px 12px;
      gap: 8px;
      scrollbar-width: none;
      background: rgba(255,255,255,0.9);
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 10px rgba(0,0,0,0.03);
      z-index: 10;
      position: relative;
    }
    
    .tabs::-webkit-scrollbar {
      display: none;
    }
    
    .tab-btn {
      flex: 0 0 auto;
      padding: 6px 14px;
      border: none;
      border-radius: 20px;
      background: #e9ecef;
      color: var(--text);
      font-size: clamp(0.8rem, 3vw, 0.9rem);
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.2s ease;
    }
    
    .tab-btn.active {
      background: var(--accent-1);
      color: white;
    }
    
    /* ä¸»å†…å®¹åŒº */
    .main-container {
      flex: 1;
      width: 100%;
      padding: 0;
      display: flex;
      flex-direction: column;
    }
    
    /* æ¸¸æˆå®¹å™¨é€šç”¨æ ·å¼ */
    .game-container {
      flex: 1;
      width: 100%;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 16px;
      position: relative;
    }
    
    .game-container.active {
      display: flex;
    }
    
    .game-card {
      width: 100%;
      height: 100%;
      max-width: none;
      background: var(--card-bg);
      border-radius: 0;
      box-shadow: none;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
    }
    
    .game-content {
      flex: 1;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }
    
    .game-instructions {
      font-size: clamp(0.8rem, 3vw, 0.9rem);
      text-align: center;
      margin-top: 16px;
      padding: 0 8px;
      line-height: 1.5;
      max-width: 600px;
      background: rgba(255,255,255,0.8);
      padding: 8px 16px;
      border-radius: 12px;
      backdrop-filter: blur(5px);
      z-index: 10;
      position: relative;
    }
    
    .encourage-text {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255,255,255,0.9);
      padding: 6px 12px;
      border-radius: 16px;
      font-size: clamp(0.75rem, 3vw, 0.85rem);
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
      max-width: 80%;
      text-align: center;
      z-index: 10;
    }
    
    .encourage-text.show {
      opacity: 1;
      pointer-events: auto;
    }
    
    .interaction-btns {
      display: flex;
      gap: 8px;
      margin-top: 12px;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 10px;
      z-index: 10;
      position: relative;
    }
    
    .interact-btn {
      padding: 8px 16px;
      border: 1px solid var(--accent-1);
      border-radius: 16px;
      background: transparent;
      color: var(--accent-1);
      font-size: clamp(0.75rem, 3vw, 0.85rem);
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .interact-btn:hover {
      background: var(--accent-1);
      color: white;
    }
    
    .control-btn {
      position: absolute;
      bottom: 20px;
      right: 20px;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: none;
      background: white;
      color: var(--text);
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 1rem;
      z-index: 10;
    }
    
    /* 1. å‘¼å¸æ³¡æ³¡ */
    #bubble {
      width: clamp(120px, 50vw, 220px);
      height: clamp(120px, 50vw, 220px);
      border-radius: 50%;
      background: var(--accent-1);
      opacity: 0.7;
      transition: transform 4s cubic-bezier(0.4, 0, 0.6, 1);
    }
    
    #bubble-guide {
      position: absolute;
      color: var(--text);
      font-size: clamp(0.9rem, 3vw, 1.1rem);
    }
    
    /* 3. æŠ˜çº¸é›¨ï¼ˆå…¨å±äº¤äº’ï¼‰ */
    #paper-container {
      width: 100%;
      height: 100%;
      position: relative;
      background: #f5f5f5;
      overflow: hidden;
    }
    
    .fold {
      position: absolute;
      font-size: clamp(0.9rem, 3vw, 1.5rem); /* æ›´å°çš„çº¸å¼ å°ºå¯¸ */
      pointer-events: none;
      transition: transform 0.4s ease, opacity 0.4s ease;
    }
    
    /* 4. é›¨æ»´æ¶Ÿæ¼ª */
    #rain-container {
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      background: #f0f4f8;
      overflow: hidden;
      cursor: pointer;
    }
    
    .ripple {
      position: absolute;
      border-radius: 50%;
      opacity: 0.6;
      pointer-events: none;
      filter: blur(0.5px);
    }
    
    /* 5. é™æ­¢çš„è¡¨æƒ… */
    #emoji-game {
      width: 100%;
      height: 100%;
      border-radius: 8px;
      background: #fff8f0;
      border: 1px solid #ffe8d6;
      overflow: hidden;
      cursor: pointer;
      position: relative;
    }
    
    .emoji-item {
      position: absolute;
      font-size: clamp(1rem, 4vw, 1.8rem);
    }
    
    #emoji-status {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: clamp(0.8rem, 3vw, 0.9rem);
      color: var(--text);
      background: rgba(255,255,255,0.8);
      padding: 6px 12px;
      border-radius: 15px;
      backdrop-filter: blur(5px);
      z-index: 5;
    }
    
    .difficulty-btns {
      display: flex;
      gap: 8px;
      margin-top: 10px;
      z-index: 10;
      position: relative;
    }
    
    .difficulty-btn {
      padding: 4px 10px;
      border-radius: 12px;
      border: 1px solid var(--accent-1);
      background: transparent;
      color: var(--accent-1);
      font-size: 0.8rem;
      cursor: pointer;
    }
    
    .difficulty-btn.active {
      background: var(--accent-1);
      color: white;
    }
  </style>
</head>
<body>
  <header>
    <a href="index.html" class="three-king-link">Three King</a>
    <div class="app-title">Take it easyï¼</div>
    <div class="app-desc">é™ä¸ä¸‹æ¥ï¼Ÿç©30ç§’ï¼Œè®©å¤§è„‘æ…¢ä¸‹æ¥</div>
  </header>
  
  <div class="tabs">
    <button class="tab-btn active" data-game="breathe">å‘¼å¸æ³¡æ³¡</button>
    <button class="tab-btn" data-game="paper">æŠ˜çº¸é›¨</button>
    <button class="tab-btn" data-game="rain">é›¨æ»´æ¶Ÿæ¼ª</button>
    <button class="tab-btn" data-game="emoji">é™æ­¢è¡¨æƒ…</button>
  </div>
  
  <div class="main-container">
    <!-- 1. å‘¼å¸æ³¡æ³¡ -->
    <div class="game-container active" id="breathe">
      <div class="game-card">
        <div class="encourage-text" id="breathe-encourage">è·Ÿç€èŠ‚å¥å‘¼å¸ï¼Œæ„Ÿå—å¹³é™</div>
        <div class="game-content">
          <div id="bubble"></div>
          <div id="bubble-guide">å¸æ°”...</div>
        </div>
        <div class="game-instructions">
          æ³¡æ³¡è†¨èƒ€æ—¶å¸æ°”ï¼Œæ”¶ç¼©æ—¶å‘¼æ°”ï¼Œé‡å¤å‡ æ¬¡ï¼Œè®©å‘¼å¸å¹³ç¨³ä¸‹æ¥
        </div>
        <div class="interaction-btns">
          <button class="interact-btn" data-resp="breathe-1">æ„Ÿè§‰å¹³é™å¤šäº†</button>
          <button class="interact-btn" data-resp="breathe-2">å†è¯•ä¸€æ¬¡</button>
        </div>
        <button class="control-btn" id="bubble-reset" title="é‡ç½®">â†º</button>
      </div>
    </div>
    
    <!-- 3. æŠ˜çº¸é›¨ï¼ˆå…¨å±äº¤äº’ï¼‰ -->
    <div class="game-container" id="paper">
      <div class="game-card">
        <div class="encourage-text" id="paper-encourage">æ¯å¼ çº¸éƒ½æœ‰è‡ªå·±çš„è½¨è¿¹</div>
        <div class="game-content">
          <!-- ç§»é™¤å®¹å™¨é™åˆ¶ï¼Œç›´æ¥å…¨å± -->
          <div id="paper-container"></div>
        </div>
        <div class="game-instructions">
          çœ‹çº¸å¼ ç¼“ç¼“é£˜è½ï¼Œç‚¹å‡»å±å¹•ä»»æ„ä½ç½®å¢åŠ æ›´å¤šçº¸å¼ ï¼Œæ„Ÿå—è¿™ä»½å®é™
        </div>
        <div class="interaction-btns">
          <button class="interact-btn" data-resp="paper-1">å¾ˆæ”¾æ¾</button>
          <button class="interact-btn" data-resp="paper-2">æ¢ç§æ ·å¼</button>
        </div>
        <button class="control-btn" id="paper-clear" title="æ¸…é™¤">âœ•</button>
      </div>
    </div>
    
    <!-- 4. é›¨æ»´æ¶Ÿæ¼ª -->
    <div class="game-container" id="rain">
      <div class="game-card">
        <div class="encourage-text" id="rain-encourage">æ¶Ÿæ¼ªæ‰©æ•£ï¼Œå¸¦èµ°çƒ¦èº</div>
        <div class="game-content">
          <div id="rain-container"></div>
        </div>
        <div class="game-instructions">
          ç‚¹å‡»å±å¹•ä»»æ„ä½ç½®åˆ›é€ æ¶Ÿæ¼ªï¼Œæ„Ÿå—æ°´æ³¢æ‰©æ•£çš„å®é™ï¼Œä»¿ä½›é›¨æ»´è½åœ¨æ¹–é¢
        </div>
        <div class="interaction-btns">
          <button class="interact-btn" data-resp="rain-1">åƒçœŸçš„é›¨å£°</button>
          <button class="interact-btn" data-resp="rain-2">å¤šæ¥ç‚¹æ¶Ÿæ¼ª</button>
        </div>
        <button class="control-btn" id="rain-reset" title="é‡ç½®">â†º</button>
      </div>
    </div>
    
    <!-- 5. é™æ­¢çš„è¡¨æƒ… -->
    <div class="game-container" id="emoji">
      <div class="game-card">
        <div class="encourage-text" id="emoji-encourage">æ‰¾åˆ°é‚£ä¸ªä¸åŠ¨çš„è¡¨æƒ…ï¼ˆé€Ÿåº¦æ›´å¿«ï¼ï¼‰</div>
        <div class="game-content">
          <div id="emoji-game">
            <div id="emoji-status">å¯»æ‰¾é™æ­¢çš„è¡¨æƒ…...</div>
          </div>
        </div>
        <div class="game-instructions">
          åœ¨å¿«é€Ÿç§»åŠ¨çš„ä¼—å¤šè¡¨æƒ…ä¸­ï¼Œæ‰¾å‡ºé‚£ä¸ªå®Œå…¨é™æ­¢çš„ï¼Œç‚¹å‡»å®ƒã€‚æŒ‘æˆ˜ä½ çš„æé™ä¸“æ³¨åŠ›ï¼
        </div>
        <div class="difficulty-btns">
          <button class="difficulty-btn" data-difficulty="easy">ç®€å•</button>
          <button class="difficulty-btn" data-difficulty="medium">ä¸­ç­‰</button>
          <button class="difficulty-btn active" data-difficulty="hard">å›°éš¾</button>
        </div>
        <div class="interaction-btns">
          <button class="interact-btn" data-resp="emoji-1">æ‰¾åˆ°äº†ï¼</button>
          <button class="interact-btn" data-resp="emoji-2">å†ç©ä¸€æ¬¡</button>
        </div>
        <button class="control-btn" id="emoji-reset" title="é‡ç½®">â†º</button>
      </div>
    </div>
  </div>

  <script>
    // å“åº”å¼å¸ƒå±€
    function adjustGameSize() {
      const gameContents = document.querySelectorAll('.game-content');
      gameContents.forEach(content => {
        content.style.height = `${content.parentElement.offsetHeight - 100}px`;
      });
    }
    
    window.addEventListener('load', adjustGameSize);
    window.addEventListener('resize', adjustGameSize);
    
    // æ ‡ç­¾åˆ‡æ¢
    const tabBtns = document.querySelectorAll('.tab-btn');
    const gameContainers = document.querySelectorAll('.game-container');
    
    tabBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const targetGame = btn.getAttribute('data-game');
        tabBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        gameContainers.forEach(container => container.classList.remove('active'));
        document.getElementById(targetGame).classList.add('active');
        showEncouragement(targetGame);
        adjustGameSize();
      });
    });
    
    // é¼“åŠ±æ–‡å­—ç³»ç»Ÿ
    const encourageTexts = {
      breathe: [
        "å‘¼å¸æ˜¯æœ€å¥½çš„æ”¾æ¾æ–¹å¼",
        "å¸æ°”4ç§’ï¼Œå‘¼æ°”4ç§’ï¼Œä½ åšå¾—å¾ˆå¥½",
        "æ„Ÿå—è…¹éƒ¨éšå‘¼å¸èµ·ä¼",
        "æ¯ä¸€æ¬¡å‘¼å¸éƒ½è®©ä½ æ›´å¹³é™"
      ],
      paper: [
        "æ¯å¼ çº¸éƒ½æœ‰è‡ªå·±çš„æ—…ç¨‹ï¼Œä¸å¿…æ€¥ç€åˆ°è¾¾ç»ˆç‚¹",
        "è®©è§†çº¿è·Ÿéšä¸€å¼ çº¸ï¼Œæš‚æ—¶æ”¾ä¸‹å…¶ä»–æ€ç»ª",
        "é£˜è½çš„çº¸å¼ åƒçº·ä¹±çš„æƒ³æ³•ï¼Œæœ€ç»ˆéƒ½ä¼šå¹³æ¯",
        "æ¯ä¸€å¼ çº¸éƒ½æ˜¯ç‹¬ç‰¹çš„ï¼Œå°±åƒæ¯ä¸€åˆ»çš„æ„Ÿå—"
      ],
      rain: [
        "æ¶Ÿæ¼ªæ‰©æ•£çš„æ ·å­ï¼Œå°±åƒå¹³é™åœ¨è”“å»¶",
        "é›¨æ»´è½ä¸‹çš„å£°éŸ³ï¼Œèƒ½æ´—å»å¤§è„‘çš„ç–²æƒ«",
        "æ¯ä¸€åœˆæ¶Ÿæ¼ªéƒ½åœ¨è¯´ï¼šä¸€åˆ‡éƒ½ä¼šå¹³æ¯",
        "æƒ³è±¡çƒ¦æ¼åƒæ¶Ÿæ¼ªä¸€æ ·ï¼Œæ…¢æ…¢æ¶ˆæ•£"
      ],
      emoji: [
        "é€Ÿåº¦å¾ˆå¿«ï¼é›†ä¸­æ‰€æœ‰æ³¨æ„åŠ›",
        "çœ¼ç›å’Œå¤§è„‘æ­£åœ¨é«˜é€Ÿè¿è½¬ï¼ŒåšæŒä½",
        "é™æ­¢çš„é‚£ä¸ªå°±åœ¨å…¶ä¸­ï¼Œä»”ç»†æ‰¾",
        "æŒ‘æˆ˜æé™ä¸“æ³¨åŠ›ï¼Œä½ å¯ä»¥çš„ï¼"
      ]
    };
    
    const responseTexts = {
      "breathe-1": "å¤ªå¥½äº†ï¼è¿™ç§å¹³é™èƒ½å¸®ä½ æ›´å¥½åœ°ä¸“æ³¨",
      "breathe-2": "æ²¡é—®é¢˜ï¼Œå†æ¥ä¸€è½®æ·±å‘¼å¸",
      "paper-1": "å¤ªæ£’äº†ï¼æ”¾æ¾æ˜¯ä¸ºäº†æ›´å¥½åœ°å‰è¿›",
      "paper-2": "æ–°çš„çº¸å¼ æ¥äº†ï¼Œç»§ç»­äº«å—å®é™å§",
      "rain-1": "é›¨å£°æ€»èƒ½è®©äººå¹³é™ï¼Œåƒå¤§è‡ªç„¶åœ¨å®‰æŠšæˆ‘ä»¬",
      "rain-2": "çœ‹ï¼Œæ›´å¤šæ¶Ÿæ¼ªåœ¨æ‰©æ•£ï¼Œå¸¦èµ°çƒ¦èº",
      "emoji-1": "å¤ªå‰å®³äº†ï¼ä½ æ‹¥æœ‰è¶…å¼ºä¸“æ³¨åŠ›ï¼",
      "emoji-2": "å†æ¥æŒ‘æˆ˜ä¸€æ¬¡ï¼"
    };
    
    function showEncouragement(game) {
      document.querySelectorAll('.encourage-text').forEach(el => el.classList.remove('show'));
      const elem = document.getElementById(`${game}-encourage`);
      if (elem) {
        const texts = encourageTexts[game];
        elem.textContent = texts[Math.floor(Math.random() * texts.length)];
        elem.classList.add('show');
      }
    }
    
    // äº’åŠ¨æŒ‰é’®äº‹ä»¶
    const interactBtns = document.querySelectorAll('.interact-btn');
    interactBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const respKey = btn.getAttribute('data-resp');
        const game = respKey.split('-')[0];
        const elem = document.getElementById(`${game}-encourage`);
        elem.textContent = responseTexts[respKey];
        elem.classList.add('show');
        
        if (respKey === 'paper-2') changePaperType();
        if (respKey === 'rain-2') addMoreRipples();
        if (respKey === 'emoji-2') startEmojiGame(currentDifficulty);
        
        setTimeout(() => showEncouragement(game), 3000);
      });
    });
    
    // 1. å‘¼å¸æ³¡æ³¡
    let isGrowing = true;
    const bubble = document.getElementById('bubble');
    const bubbleGuide = document.getElementById('bubble-guide');
    
    function breatheAnimation() {
      if (isGrowing) {
        bubble.style.transform = 'scale(1.4)';
        bubbleGuide.textContent = 'å¸æ°”...';
      } else {
        bubble.style.transform = 'scale(1)';
        bubbleGuide.textContent = 'å‘¼æ°”...';
      }
      isGrowing = !isGrowing;
    }
    
    let breatheInterval = setInterval(breatheAnimation, 4000);
    
    document.getElementById('bubble-reset').addEventListener('click', () => {
      clearInterval(breatheInterval);
      bubble.style.transform = 'scale(1)';
      isGrowing = true;
      bubbleGuide.textContent = 'å¸æ°”...';
      breatheInterval = setInterval(breatheAnimation, 4000);
      showEncouragement('breathe');
    });
    
    // 3. æŠ˜çº¸é›¨ï¼ˆå…¨å±äº¤äº’ï¼‰
    const paperContainer = document.getElementById('paper-container');
    let paperTypes = ['ğŸ“œ', 'ğŸ“„', 'ğŸ“ƒ', 'ğŸ“‘'];
    const paperElements = [];
    
    const paperConfig = {
      minLifetime: 7000,
      maxLifetime: 12000,
      spawnInterval: 1000, // é™ä½ç”Ÿæˆé¢‘ç‡ï¼ˆæ›´å°‘çº¸å¼ ï¼‰
      clickSpawnCount: 5,
      initialFallSpeedRange: [0.1, 0.5], // æ…¢é€Ÿä¸‹è½
      gravity: 0.002,
      maxFallSpeed: 1.2,
      driftFrequencyRange: [0.006, 0.015],
      driftAmplitudeRange: [0.6, 2],
      rotateSpeedRange: [-0.15, 0.15],
      rotateDamping: 0.996
    };
    
    function createPaper(isClickSpawn = false) {
      const paper = document.createElement('div');
      paper.className = 'fold';
      paper.innerHTML = paperTypes[Math.floor(Math.random() * paperTypes.length)];

      // å…¨å±å®¹å™¨å°ºå¯¸
      const container = paperContainer;
      const containerRect = container.getBoundingClientRect();
      const containerWidth = containerRect.width;
      const containerHeight = containerRect.height;

      // éšæœºèµ·å§‹ä½ç½®ï¼ˆå…¨å±èŒƒå›´ï¼‰
      const startLeft = isClickSpawn 
        ? (Math.random() * containerWidth) / containerWidth * 100 
        : Math.random() * 100;
      paper.style.left = startLeft + '%';
      paper.style.top = isClickSpawn ? Math.random() * 10 + '%' : '-10%';

      const initialOpacity = 0.8 + Math.random() * 0.2;
      const initialSize = 1.2 + Math.random() * 0.3; // æ›´å°çš„åˆå§‹å°ºå¯¸
      paper.style.opacity = 0;
      paper.style.transform = `scale(0.5) rotate(0deg)`;

      // æŸ”å’Œçš„çº¸å¼ é¢œè‰²
      const colors = ['#90cdf4', '#9ae6b4', '#b794f4', '#f6ad55', '#fda4af'];
      paper.style.color = colors[Math.floor(Math.random() * colors.length)];

      container.appendChild(paper);
      paperElements.push(paper);

      setTimeout(() => {
        paper.style.opacity = initialOpacity;
        paper.style.transform = `scale(${initialSize}) rotate(0deg)`;
      }, 10);

      const physics = {
        fallSpeed: paperConfig.initialFallSpeedRange[0] + Math.random() * (paperConfig.initialFallSpeedRange[1] - paperConfig.initialFallSpeedRange[0]),
        left: startLeft,
        rotateAngle: 0,
        rotateSpeed: (Math.random() - 0.5) * 0.15,
        driftPhase: Math.random() * Math.PI * 2,
        driftFrequency: paperConfig.driftFrequencyRange[0] + Math.random() * (paperConfig.driftFrequencyRange[1] - paperConfig.driftFrequencyRange[0]),
        lifetime: 0,
        maxLifetime: paperConfig.minLifetime + Math.random() * (paperConfig.maxLifetime - paperConfig.minLifetime)
      };

      function fall() {
        if (!paper.parentNode) return;
        physics.lifetime += 16;

        physics.fallSpeed = Math.min(physics.fallSpeed + paperConfig.gravity, paperConfig.maxFallSpeed);
        const currentTop = parseFloat(paper.style.top) || (isClickSpawn ? 0 : -50);
        const newTop = currentTop + physics.fallSpeed;
        paper.style.top = newTop + 'px';

        const windEffect = Math.sin(physics.lifetime * physics.driftFrequency + physics.driftPhase) * paperConfig.driftAmplitudeRange[0];
        physics.left += windEffect * 0.04;
        physics.left = Math.max(5, Math.min(95, physics.left));
        paper.style.left = physics.left + '%';

        physics.rotateSpeed *= paperConfig.rotateDamping;
        physics.rotateAngle += physics.rotateSpeed;
        const maxRotate = isClickSpawn ? 45 : 30;
        physics.rotateAngle = Math.max(-maxRotate, Math.min(maxRotate, physics.rotateAngle));
        paper.style.transform = `scale(${initialSize}) rotate(${physics.rotateAngle}deg)`;

        const isOutOfBounds = newTop > containerHeight + 30;
        const isLifetimeEnded = physics.lifetime > physics.maxLifetime;

        if (isOutOfBounds && isLifetimeEnded) {
          paper.style.transition = 'opacity 1.5s ease, transform 1.5s ease';
          paper.style.opacity = 0;
          paper.style.transform = `scale(${initialSize * 0.7}) rotate(${physics.rotateAngle}deg)`;

          setTimeout(() => {
            paper.remove();
            const index = paperElements.indexOf(paper);
            if (index > -1) paperElements.splice(index, 1);
          }, 1500);
        } else {
          requestAnimationFrame(fall);
        }
      }

      fall();
    }
    
    // è‡ªåŠ¨ç”Ÿæˆçº¸å¼ ï¼ˆä»…åœ¨æŠ˜çº¸é›¨æ¿€æ´»æ—¶ï¼‰
    setInterval(() => {
      if (document.getElementById('paper').classList.contains('active')) {
        createPaper(false);
      }
    }, paperConfig.spawnInterval);
    
    // å…¨å±ç‚¹å‡»ç”Ÿæˆçº¸å¼ 
    paperContainer.addEventListener('click', (e) => {
      const rect = paperContainer.getBoundingClientRect();
      const clickXPercent = ((e.clientX - rect.left) / rect.width) * 100;

      const clickSound = new Audio('data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAzMzMzMzMzM5WZmZmZmZmnd7e3t7e3uHl5eXl5eXno6Ojo6Ojo6iwsLCwsLCvi4uLi4uLi52tra2tra2u7u7u7u7u7+/v7+/v7+/');
      clickSound.volume = 0.2;
      clickSound.play().catch(e => {});

      for (let i = 0; i < paperConfig.clickSpawnCount; i++) {
        setTimeout(() => {
          const paper = document.createElement('div');
          paper.className = 'fold';
          paper.innerHTML = paperTypes[Math.floor(Math.random() * paperTypes.length)];

          const left = clickXPercent + (Math.random() * 10 - 5);
          const top = Math.random() * 8;
          paper.style.left = left + '%';
          paper.style.top = top + '%';

          const opacity = 0.85 + Math.random() * 0.15;
          const size = 1.3 + Math.random() * 0.3;
          paper.style.opacity = 0;
          paper.style.transform = `scale(0.5) rotate(0deg)`;

          const colors = ['#90cdf4', '#9ae6b4', '#b794f4', '#f6ad55', '#fda4af'];
          paper.style.color = colors[Math.floor(Math.random() * colors.length)];

          paperContainer.appendChild(paper);
          paperElements.push(paper);

          setTimeout(() => {
            paper.style.opacity = opacity;
            paper.style.transform = `scale(${size}) rotate(0deg)`;
          }, 10);

          const clickPhysics = {
            fallSpeed: paperConfig.initialFallSpeedRange[0] + Math.random() * 0.6,
            left: left,
            rotateAngle: 0,
            rotateSpeed: (Math.random() - 0.5) * 0.25,
            driftPhase: Math.random() * Math.PI * 2,
            driftFrequency: paperConfig.driftFrequencyRange[0] + Math.random() * 0.005,
            lifetime: 0,
            maxLifetime: paperConfig.minLifetime + 1000 + Math.random() * (paperConfig.maxLifetime - paperConfig.minLifetime)
          };

          function clickFall() {
            if (!paper.parentNode) return;
            clickPhysics.lifetime += 16;

            clickPhysics.fallSpeed = Math.min(
              clickPhysics.fallSpeed + paperConfig.gravity * 1.2,
              paperConfig.maxFallSpeed * 1.1
            );
            const currentTop = parseFloat(paper.style.top);
            const newTop = currentTop + clickPhysics.fallSpeed;
            paper.style.top = newTop + 'px';

            const windEffect = Math.sin(clickPhysics.lifetime * clickPhysics.driftFrequency + clickPhysics.driftPhase) * paperConfig.driftAmplitudeRange[0] * 0.8;
            clickPhysics.left += windEffect * 0.05;
            clickPhysics.left = Math.max(5, Math.min(95, clickPhysics.left));
            paper.style.left = clickPhysics.left + '%';

            clickPhysics.rotateSpeed *= paperConfig.rotateDamping;
            clickPhysics.rotateAngle += clickPhysics.rotateSpeed;
            clickPhysics.rotateAngle = Math.max(-45, Math.min(45, clickPhysics.rotateAngle));
            paper.style.transform = `scale(${size}) rotate(${clickPhysics.rotateAngle}deg)`;

            const isOutOfBounds = newTop > paperContainer.offsetHeight + 20;
            const isLifetimeEnded = clickPhysics.lifetime > clickPhysics.maxLifetime;

            if (isOutOfBounds && isLifetimeEnded) {
              paper.style.transition = 'opacity 1.5s ease, transform 1.5s ease';
              paper.style.opacity = 0;
              paper.style.transform = `scale(${size * 0.6}) rotate(${clickPhysics.rotateAngle}deg)`;

              setTimeout(() => {
                paper.remove();
                const idx = paperElements.indexOf(paper);
                if (idx > -1) paperElements.splice(idx, 1);
              }, 1500);
            } else {
              requestAnimationFrame(clickFall);
            }
          }

          clickFall();
        }, i * 100);
      }
    });
    
    // æ¸…é™¤çº¸å¼ 
    document.getElementById('paper-clear').addEventListener('click', () => {
      paperElements.forEach(paper => {
        paper.style.transition = 'opacity 0.8s ease, transform 0.8s ease';
        paper.style.opacity = 0;
        paper.style.transform = 'scale(0.3)';
        setTimeout(() => paper.remove(), 800);
      });
      paperElements.length = 0;
    });
    
    // åˆ‡æ¢çº¸å¼ ç±»å‹
    function changePaperType() {
      const typeGroups = [
        ['ğŸ“œ', 'ğŸ“„', 'ğŸ“ƒ', 'ğŸ“‘'],
        ['ğŸƒ', 'ğŸ‚', 'ğŸŒ¿', 'ğŸŒ¾'],
        ['â„ï¸', 'ğŸŒ¨ï¸', 'â˜ï¸', 'ğŸƒ']
      ];
      let newTypes;
      do {
        newTypes = typeGroups[Math.floor(Math.random() * typeGroups.length)];
      } while (newTypes === paperTypes);
      paperTypes = newTypes;
    }
    
    // 4. é›¨æ»´æ¶Ÿæ¼ªï¼ˆä¼˜åŒ–é¢œè‰²å’Œå°ºå¯¸ï¼Œå¢åŠ è‡ªåŠ¨ç”Ÿæˆé¢‘ç‡å’ŒèŒƒå›´ï¼‰
const rainContainer = document.getElementById('rain-container');

// å‡å°‘æ¶Ÿæ¼ªé¢œè‰²ï¼ˆä»…ä¿ç•™æµ…è“ã€æµ…ç»¿ä¸¤ç§æŸ”å’Œè‰²è°ƒï¼‰
const rippleColors = ['#90cdf480', '#9ae6b480']; // ç§»é™¤äº† '#b794f480'ï¼ˆæµ…ç´«è‰²ï¼‰

function createRipple(x, y, isClick = false) {
  const ripple = document.createElement('div');
  ripple.className = 'ripple';
  
  // ç¼©å°æ¶Ÿæ¼ªå°ºå¯¸ï¼ˆæœ€å¤§150pxï¼‰
  const size = isClick 
    ? 60 + Math.random() * 90  // ç‚¹å‡»ç”Ÿæˆï¼š60-150px
    : 40 + Math.random() * 60; // è‡ªåŠ¨ç”Ÿæˆï¼š40-100px
  ripple.style.width = size + 'px';
  ripple.style.height = size + 'px';
  ripple.style.left = (x - size/2) + 'px';
  ripple.style.top = (y - size/2) + 'px';
  
  // ä½¿ç”¨ç»Ÿä¸€çš„æŸ”å’Œé¢œè‰²ï¼ˆå·²ç§»é™¤ç´«è‰²ï¼‰
  ripple.style.background = rippleColors[Math.floor(Math.random() * rippleColors.length)];
  
  rainContainer.appendChild(ripple);
  
  // æ‰©æ•£èŒƒå›´å’ŒåŠ¨ç”»æ—¶é•¿ä¿æŒä¸å˜
  const scale = isClick 
    ? 3 + Math.random() * 2  // ç‚¹å‡»ç”Ÿæˆï¼š3-5å€
    : 3 + Math.random() * 3; // è‡ªåŠ¨ç”Ÿæˆï¼š3-6å€
  
  const duration = isClick 
    ? 3 + Math.random()      // ç‚¹å‡»ç”Ÿæˆï¼š3-4ç§’
    : 3 + Math.random() * 2; // è‡ªåŠ¨ç”Ÿæˆï¼š3-5ç§’
  
  setTimeout(() => {
    ripple.style.transition = `transform ${duration}s cubic-bezier(0.2, 0.8, 0.2, 1), opacity ${duration}s ease-out`;
    ripple.style.transform = `scale(${scale})`;
    ripple.style.opacity = '0';
    
    setTimeout(() => ripple.remove(), duration * 1000);
  }, 10);
}
    
    // ã€æ ¸å¿ƒä¿®æ”¹3ï¼šæé«˜è‡ªåŠ¨ç”Ÿæˆé¢‘ç‡ï¼ˆç¼©çŸ­é—´éš”ï¼‰ã€‘
    // ä»åŸæ¥çš„3000msï¼ˆ3ç§’ï¼‰â†’ æ”¹ä¸º1000msï¼ˆ1ç§’ï¼‰ï¼Œç”Ÿæˆæ›´é¢‘ç¹
    setInterval(() => {
      if (document.getElementById('rain').classList.contains('active')) {
        const x = Math.random() * window.innerWidth;
        const y = Math.random() * window.innerHeight;
        createRipple(x, y); // è‡ªåŠ¨ç”Ÿæˆæ¶Ÿæ¼ª
      }
    }, 1000); // 1ç§’ç”Ÿæˆä¸€ä¸ªï¼ˆé¢‘ç‡æé«˜ï¼‰
    
    // å…¨å±ç‚¹å‡»ç”Ÿæˆæ¶Ÿæ¼ª
    rainContainer.addEventListener('click', (e) => {
      const x = e.clientX;
      const y = e.clientY;

      // ç‚¹å‡»ç”Ÿæˆå°‘é‡æ¶Ÿæ¼ªï¼ˆ3ä¸ªï¼‰
      for (let i = 0; i < 3; i++) {
        setTimeout(() => {
          createRipple(
            x + (Math.random() * 40 - 20),
            y + (Math.random() * 40 - 20),
            true
          );
        }, i * 150);
      }
    });
    
    // å¤šæ¥ç‚¹æ¶Ÿæ¼ªæŒ‰é’®
    function addMoreRipples() {
      for (let i = 0; i < 5; i++) {
        setTimeout(() => {
          const x = Math.random() * window.innerWidth;
          const y = Math.random() * window.innerHeight;
          createRipple(x, y, true);
        }, i * 250);
      }
    }
    
    // é‡ç½®æ¶Ÿæ¼ª
    document.getElementById('rain-reset').addEventListener('click', () => {
      document.querySelectorAll('.ripple').forEach(r => r.remove());
    });
    
    // 5. é™æ­¢çš„è¡¨æƒ…
    const emojiGame = document.getElementById('emoji-game');
    const emojiStatus = document.getElementById('emoji-status');
    const difficultyBtns = document.querySelectorAll('.difficulty-btn');
    let emojiItems = [];
    let staticEmoji = null;
    let currentDifficulty = 'hard';
    
    const difficultyConfig = {
      easy: { count: window.innerWidth < 400 ? 30 : 50, baseSpeed: 0.5, speedVariation: 1.5, range: 10, rangeVariation: 20, sameRatio: 0.5, encouragement: "ç®€å•æ¨¡å¼ï¼šä½ å¯ä»¥çš„ï¼" },
      medium: { count: window.innerWidth < 400 ? 80 : 120, baseSpeed: 1, speedVariation: 2, range: 15, rangeVariation: 25, sameRatio: 0.75, encouragement: "ä¸­ç­‰æ¨¡å¼ï¼šéš¾åº¦å‡çº§äº†ï¼" },
      hard: { count: window.innerWidth < 400 ? 150 : 200, baseSpeed: 1.5, speedVariation: 3, range: 20, rangeVariation: 30, sameRatio: 0.2, encouragement: "å›°éš¾æ¨¡å¼ï¼šæé™æŒ‘æˆ˜ï¼" }
    };
    
    const emojis = ['ğŸ˜Š', 'ğŸ˜', 'ğŸ˜', 'ğŸ¥º', 'ğŸ˜œ', 'ğŸ¤©', 'ğŸ¤”', 'ğŸ˜Œ', 'ğŸ™‚', 'ğŸ˜‡', 'ğŸ¥°', 'ğŸ˜‰', 'ğŸ˜Œ', 'ğŸ¤—', 'ğŸ¤­', 'ğŸ˜‹', 'ğŸ˜˜', 'ğŸ¤ª', 'ğŸ¤«', 'ğŸ¤­'];
    
    difficultyBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        difficultyBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentDifficulty = btn.getAttribute('data-difficulty');
        const elem = document.getElementById('emoji-encourage');
        elem.textContent = difficultyConfig[currentDifficulty].encouragement;
        elem.classList.add('show');
        startEmojiGame(currentDifficulty);
      });
    });
    
    function startEmojiGame(difficulty) {
      emojiItems.forEach(emoji => emoji.remove());
      emojiItems = [];
      const config = difficultyConfig[difficulty];
      const staticType = emojis[Math.floor(Math.random() * emojis.length)];
      staticEmoji = null;
      
      for (let i = 0; i < config.count; i++) {
        const emoji = document.createElement('div');
        emoji.className = 'emoji-item';
        const isSame = Math.random() > (1 - config.sameRatio);
        emoji.textContent = isSame ? staticType : emojis[Math.floor(Math.random() * emojis.length)];
        emoji.style.left = Math.random() * 100 + '%';
        emoji.style.top = Math.random() * 100 + '%';
        const colors = ['var(--accent-1)', 'var(--accent-2)', 'var(--accent-3)'];
        emoji.style.color = colors[Math.floor(Math.random() * colors.length)];
        emojiGame.appendChild(emoji);
        emojiItems.push(emoji);
        
        if (i === 0) {
          staticEmoji = emoji;
          emoji.dataset.static = 'true';
        } else {
          animateEmoji(emoji, config);
        }
      }
      
      emojiStatus.textContent = `å¯»æ‰¾é™æ­¢çš„è¡¨æƒ…... ${difficulty === 'easy' ? 'ç®€å•' : difficulty === 'medium' ? 'ä¸­ç­‰' : 'å›°éš¾'}æ¨¡å¼`;
    }
    
    function animateEmoji(emoji, config) {
      const startX = parseFloat(emoji.style.left);
      const startY = parseFloat(emoji.style.top);
      const speed = config.baseSpeed + Math.random() * config.speedVariation;
      const range = config.range + Math.random() * config.rangeVariation;
      const direction = Math.random() * Math.PI * 2;
      const moveMode = Math.floor(Math.random() * 3);
      const phaseX = Math.random() * Math.PI * 2;
      const phaseY = Math.random() * Math.PI * 2;
      let time = 0;

      function move() {
        if (!emoji.parentNode) return;
        time += 0.01;
        let x, y;
        
        switch (moveMode) {
          case 0:
            const radius = range * 0.5;
            const angle = time * speed + direction;
            x = startX + Math.cos(angle + phaseX) * radius;
            y = startY + Math.sin(angle + phaseY) * radius;
            break;
          case 1:
            const progress = Math.sin(time * speed + phaseX) * 0.5 + 0.5;
            x = startX + Math.cos(direction) * range * (progress - 0.5) * 2;
            y = startY + Math.sin(direction) * range * (progress - 0.5) * 2;
            break;
          case 2:
            x = startX + (Math.sin(time * speed + phaseX) * range * 0.5) + (Math.random() - 0.5) * 2;
            y = startY + (Math.cos(time * speed + phaseY) * range * 0.5) + (Math.random() - 0.5) * 2;
            break;
        }
        
        x = Math.max(0, Math.min(100, x));
        y = Math.max(0, Math.min(100, y));
        emoji.style.left = x + '%';
        emoji.style.top = y + '%';
        requestAnimationFrame(move);
      }
      
      move();
    }
    
    emojiGame.addEventListener('click', (e) => {
      const target = e.target.closest('.emoji-item');
      if (!target) return;
      
      if (target.dataset.static === 'true') {
        emojiStatus.textContent = "å¤ªå‰å®³äº†ï¼ä½ æ‹¥æœ‰è¶…å¼ºä¸“æ³¨åŠ›ï¼";
        target.style.transform = "scale(2)";
        target.style.transition = "transform 0.3s ease";
        setTimeout(() => startEmojiGame(currentDifficulty), 2000);
      } else {
        emojiStatus.textContent = "å†è¯•è¯•ï¼Œé‚£ä¸ªè¿˜åœ¨åŠ¨å‘¢";
        target.style.transform = "scale(0)";
        setTimeout(() => {
          if (target.parentNode) target.remove();
        }, 300);
      }
    });
    
    document.getElementById('emoji-reset').addEventListener('click', () => {
      startEmojiGame(currentDifficulty);
    });
    
    // åˆå§‹åŒ–
    window.addEventListener('load', () => {
      showEncouragement('breathe');
      startEmojiGame(currentDifficulty);
    });
  </script>
</body>
</html>